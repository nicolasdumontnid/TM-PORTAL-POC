<div class="dashboard-container">
  <div class="dashboard-header">
    <h1>Dashboard Filter</h1>
  </div>

  <!-- KPI Section -->
  <div class="kpi-section">
    <div class="kpi-card" *ngFor="let kpi of kpis">
      <div class="kpi-value">{{kpi.value}}</div>
      <div class="kpi-label">{{kpi.label}}</div>
      <div class="kpi-description">{{kpi.description}}</div>
    </div>
  </div>

  <!-- Selection Section -->
  <div class="selection-section">
    <h2>Filters</h2>
    
    <!-- Report Status Filter -->
    <div class="filter-group">
      <h3>Report Status</h3>
      <div class="filter-buttons">
        <button 
          class="filter-btn"
          [class.active]="selectedReportStatus === 'reported'"
          (click)="selectReportStatus('reported')"
        >
          Exams Reported ({{getReportedCount()}})
        </button>
        <button 
          class="filter-btn"
          [class.active]="selectedReportStatus === 'unreported'"
          (click)="selectReportStatus('unreported')"
        >
          Exams Non Reported ({{getUnreportedCount()}})
        </button>
      </div>
    </div>

    <!-- Site Filter -->
    <div class="filter-group">
      <h3>Site</h3>
      <div class="filter-buttons">
        <button 
          class="filter-btn"
          [class.active]="selectedSite === 'all'"
          (click)="selectSite('all')"
        >
          All Sites ({{exams.length}})
        </button>
        <button 
          class="filter-btn"
          [class.active]="selectedSite === 'principal'"
          (click)="selectSite('principal')"
        >
          Site Principal ({{getPrincipalSiteCount()}})
        </button>
        <button 
          class="filter-btn"
          [class.active]="selectedSite === 'policlinique'"
          (click)="selectSite('policlinique')"
        >
          Site Policlinique ({{getPolicliniqueSiteCount()}})
        </button>
      </div>
    </div>

    <!-- Doctor Filter -->
    <div class="filter-group">
      <h3>MÃ©decin</h3>
      <div class="filter-buttons">
        <button 
          class="filter-btn"
          [class.active]="selectedDoctor === null"
          (click)="selectDoctor(null)"
        >
          All Doctors ({{exams.length}})
        </button>
        <button 
          *ngFor="let doctor of doctors"
          class="filter-btn"
          [class.active]="selectedDoctor === doctor.name"
          (click)="selectDoctor(doctor.name)"
        >
          {{doctor.name}} ({{doctor.examCount}})
        </button>
      </div>
    </div>
  </div>

  <!-- Exams Table Section -->
  <div class="exams-section">
    <div class="exams-header">
      <h2>Exams ({{filteredExams.length}})</h2>
      <button class="select-all-btn" (click)="selectAllExams()">
        {{selectAllButtonText}}
      </button>
    </div>
    
    <div class="table-container">
      <table class="exams-table">
        <thead>
          <tr>
            <th class="checkbox-col">
              <input 
                type="checkbox" 
                [checked]="areAllFilteredExamsSelected"
                (change)="selectAllExams()"
              >
            </th>
            <th>Exam Number</th>
            <th>Description</th>
            <th>Clinical Indication</th>
            <th>Age</th>
            <th>Priority</th>
            <th>Assigned Doctor</th>
          </tr>
        </thead>
        <tbody>
          <tr 
            *ngFor="let exam of filteredExams"
            class="exam-row"
            [class.selected]="exam.isSelected"
            [class.high-priority]="exam.priority === 'high'"
            (click)="toggleExamSelection(exam)"
          >
            <td class="checkbox-col">
              <input 
                type="checkbox" 
                [checked]="exam.isSelected"
                (click)="$event.stopPropagation()"
                (change)="toggleExamSelection(exam)"
              >
            </td>
            <td class="exam-number">{{exam.examNumber}}</td>
            <td class="description">{{exam.description}}</td>
            <td class="indication">{{exam.clinicalIndication}}</td>
            <td class="age">{{getDaysOldText(exam.daysOld)}}</td>
            <td class="priority">
              <span class="priority-badge" [class.high]="exam.priority === 'high'">
                {{exam.priority === 'high' ? 'HIGH' : 'NORMAL'}}
              </span>
            </td>
            <td class="assigned-doctor">{{exam.assignedDoctor || 'Unassigned'}}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Action Buttons Section -->
  <div class="actions-section">
    <button 
      class="action-btn priority-btn"
      [disabled]="selectedExams.length === 0"
      (click)="setHighPriority()"
    >
      Set High Priority
    </button>
    <button 
      class="action-btn assign-btn"
      [disabled]="selectedExams.length === 0"
      (click)="openAssignModal()"
    >
      Assigned to...
    </button>
    <button 
      class="action-btn randomize-btn"
      [disabled]="selectedExams.length === 0"
      (click)="randomizeAssignment()"
    >
      Randomize
    </button>
    <button 
      class="action-btn close-btn-action"
      (click)="onClose()"
    >
      Close
    </button>
  </div>

  <!-- Assign Modal -->
  <div class="modal-backdrop" *ngIf="showAssignModal" (click)="closeAssignModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Assign to Doctor</h3>
        <button class="close-btn" (click)="closeAssignModal()">
          <i class="ph ph-x"></i>
        </button>
      </div>
      
      <div class="modal-body">
        <p>Select a doctor to assign {{selectedExams.length}} exam(s):</p>
        <div class="doctor-list">
          <div 
            *ngFor="let doctor of doctors"
            class="doctor-item"
            [class.selected]="selectedDoctorForAssign === doctor.name"
            (click)="selectedDoctorForAssign = doctor.name"
          >
            <div class="doctor-info">
              <div class="doctor-name">{{doctor.name}}</div>
              <div class="doctor-specialty">{{doctor.specialty}}</div>
            </div>
            <div class="doctor-count">{{doctor.examCount}} exams</div>
          </div>
        </div>
      </div>
      
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeAssignModal()">Cancel</button>
        <button 
          class="btn btn-primary" 
          [disabled]="!selectedDoctorForAssign"
          (click)="assignToDoctor()"
        >
          Assign
        </button>
      </div>
    </div>
  </div>
</div>